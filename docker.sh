#!/bin/bash
docker pull amazon/dynamodb-local
docker stop localdb;
docker run --rm --name localdb -d -p 9000:8000 amazon/dynamodb-local;
aws dynamodb create-table \
--table-name local \
--attribute-definitions \
AttributeName=partkey,\
AttributeType=S AttributeName=sortkey,\
AttributeType=S AttributeName=gsi_user_orders_partkey,\
AttributeType=S AttributeName=gsi_user_orders_sortkey,\
AttributeType=S \
--key-schema AttributeName=partkey,KeyType=HASH AttributeName=sortkey,KeyType=RANGE \
--provisioned-throughput ReadCapacityUnits=1000,WriteCapacityUnits=1000 \
--endpoint-url http://localhost:9000 \
--global-secondary-indexes '[{"IndexName":"gsi_user_orders", "KeySchema":[{"AttributeName":"gsi_user_orders_partkey","KeyType":"HASH"},{"AttributeName":"gsi_user_orders_sortkey","KeyType":"RANGE"}], "ProvisionedThroughput":{"ReadCapacityUnits":10, "WriteCapacityUnits":5},"Projection":{"ProjectionType":"ALL"}}]' \
>> /dev/null

aws dynamodb put-item --table-name local --item '{"addresses": {"L": []}, "role": {"S": "admin"}, "date_updated": {"S": "2022-12-03T00:26:30"}, "id_": {"S": "13303309-d941-486f-b600-3e90929ac50f"}, "date_created": {"S": "2022-12-03T00:26:30"}, "last_name": {"S": ""}, "login": {"S": "+79216146600"}, "partkey": {"S": "users_"}, "sortkey": {"S": "13303309-d941-486f-b600-3e90929ac50f"}, "additional_phone_numbers": {"L": []}, "phone": {"S": "+79216146600"}, "first_name": {"S": "test admin"}, "email": {"S": "admin@test.ru"}}' --endpoint-url http://localhost:9000
aws dynamodb put-item --table-name local --item '{"addresses": {"L": []}, "role": {"S": "restaurant_manager"}, "date_updated": {"S": "2022-12-03T00:26:30"}, "id_": {"S": "8178f948-cdc2-4e8c-b013-07a956e7e72a"}, "date_created": {"S": "2022-12-03T00:26:30"}, "last_name": {"S": ""}, "login": {"S": "+37066042239"}, "partkey": {"S": "users_"}, "sortkey": {"S": "8178f948-cdc2-4e8c-b013-07a956e7e72a"}, "additional_phone_numbers": {"L": []}, "phone": {"S": "+37066042239"}, "first_name": {"S": "test restaurant manager"}, "email": {"S": "restaurant-manager@test.ru"}}' --endpoint-url http://localhost:9000
aws dynamodb put-item --table-name local --item '{"addresses": {"L": []}, "role": {"S": "user"}, "date_updated": {"S": "2022-12-03T00:26:30"}, "id_": {"S": "e5b01491-e538-4be3-8d3c-a57db7fc43c1"}, "date_created": {"S": "2022-12-03T00:26:30"}, "last_name": {"S": ""}, "login": {"S": "+79061234567"}, "partkey": {"S": "users_"}, "sortkey": {"S": "e5b01491-e538-4be3-8d3c-a57db7fc43c1"}, "additional_phone_numbers": {"L": []}, "phone": {"S": "+79061234567"}, "first_name": {"S": "test user"}, "email": {"S": "user@test.ru"}}' --endpoint-url http://localhost:9000
aws dynamodb put-item --table-name local --item '{"status_": {"S": "new"}, "address": {"S": "Time Square, New York, USA"}, "date_updated": {"S": "2022-12-03T01:35:56"}, "id_": {"S": "3a1e6dc1-465f-4c8e-b9a5-a94de93a60c9"}, "date_created": {"S": "2022-12-03T00:26:30"}, "opening_time": {"N": "10"}, "cuisine": {"L": [{"S": "Chinese"}, {"S": "Japanese"}]}, "description": {"S": "This is my test restaurant"}, "title": {"S": "updated restaurant title"}, "created_by": {"S": "13303309-d941-486f-b600-3e90929ac50f"}, "partkey": {"S": "restaurants_"}, "archived": {"BOOL": false}, "sortkey": {"S": "3a1e6dc1-465f-4c8e-b9a5-a94de93a60c9"}, "closing_time": {"N": "23"}, "updated_by": {"S": "13303309-d941-486f-b600-3e90929ac50f"}, "settings": {"M": {"category_sequence": {"M": {"1": {"S": "breakfast"}, "2": {"S": "dinner"}, "3": {"S": "pizza"}}}}}}' --endpoint-url http://localhost:9000
aws dynamodb put-item --table-name local --item '{"date_updated": {"S": "2022-12-03T01:35:18"}, "id_": {"S": "0a53c744-1a68-4734-af5a-fd5bfc76e1c8"}, "date_created": {"S": "2022-12-03T01:26:03"}, "restaurant_id": {"S": "3a1e6dc1-465f-4c8e-b9a5-a94de93a60c9"}, "opening_time": {"NULL": true}, "description": {"S": "Best scrambled eggs in the world"}, "weight": {"NULL": true}, "title": {"S": "Scrambled Eggs"}, "created_by": {"S": "8178f948-cdc2-4e8c-b013-07a956e7e72a"}, "is_available": {"BOOL": true}, "partkey": {"S": "menu_items_3a1e6dc1-465f-4c8e-b9a5-a94de93a60c9"}, "archived": {"BOOL": false}, "sortkey": {"S": "0a53c744-1a68-4734-af5a-fd5bfc76e1c8"}, "closing_time": {"NULL": true}, "price": {"N": "135.99"}, "options": {"L": []}, "updated_by": {"S": "8178f948-cdc2-4e8c-b013-07a956e7e72a"}, "category": {"S": "breakfast"}}' --endpoint-url http://localhost:9000
aws dynamodb put-item --table-name local --item '{"date_updated": {"S": "2022-12-03T01:35:08"}, "id_": {"S": "6b1164c2-4e98-4923-b044-fb2219378f8c"}, "date_created": {"S": "2022-12-03T01:24:46"}, "restaurant_id": {"S": "3a1e6dc1-465f-4c8e-b9a5-a94de93a60c9"}, "opening_time": {"NULL": true}, "description": {"S": "Double meat, bacon, etc."}, "weight": {"NULL": true}, "title": {"S": "Burger"}, "created_by": {"S": "8178f948-cdc2-4e8c-b013-07a956e7e72a"}, "is_available": {"BOOL": true}, "partkey": {"S": "menu_items_3a1e6dc1-465f-4c8e-b9a5-a94de93a60c9"}, "archived": {"BOOL": false}, "sortkey": {"S": "6b1164c2-4e98-4923-b044-fb2219378f8c"}, "closing_time": {"NULL": true}, "price": {"N": "13.99"}, "options": {"L": []}, "updated_by": {"S": "8178f948-cdc2-4e8c-b013-07a956e7e72a"}, "category": {"S": "dinner"}}' --endpoint-url http://localhost:9000


#aws dynamodb update-table --endpoint-url http://localhost:9000 --table-name local --attribute-definitions AttributeName=id_,AttributeType=S --global-secondary-index-updates '[{"Create":{"IndexName":"id_-index", "KeySchema":[{"AttributeName":"id_","KeyType":"HASH"}], "ProvisionedThroughput":{"ReadCapacityUnits":10, "WriteCapacityUnits":5},"Projection":{"ProjectionType":"ALL"}}}]'
